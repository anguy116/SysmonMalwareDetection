from kafka import KafkaProducer
from kafka.errors import NoBrokersAvailable
from json import dumps
from time import sleep
if __name__ == '__main__':
    producer=None
    conn_flag=False
    print("Waiting on Elasticsearch connection ...")
    while not conn_flag:
        sleep(5)
        print(".")
        try:
            producer = KafkaProducer(
                bootstrap_servers=['kafka:9092'],
                value_serializer=lambda x: dumps(x).encode('utf-8')
                )
            conn_flag = True
        except NoBrokersAvailable:
            continue
    print(type(producer))

        