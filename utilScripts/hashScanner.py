import vt
import pandas as pd
from alive_progress import alive_bar

if __name__ == "__main__":

    # grab csv file of hashes
    filePath = input("insert file to scan for hashes ")
    hashTable = pd.read_csv(filePath, header=0)

    # establish connection to VirusTotal via client
    api_key = "44aad1fe26358166b7bb6db1f255f99888f8b208527fc502ef7c258becf8094d"
    client = vt.Client(api_key)
    print("Scanning hash set for malicious hashes")
    with alive_bar(len(hashTable)) as bar:
        for index,row in hashTable.iterrows():
            hash = row[0]
            file = client.get_object("/files/"+hash)
            hashTable.at[index,'malicious_count']= int(file.last_analysis_stats['malicious'])
            bar()

    index = hashTable['malicious_count']>0
    maliciousVals = hashTable[index]

    if len(maliciousVals) > 0:
        print("Malcious hashes found")
        print(maliciousVals.to_markdown())

